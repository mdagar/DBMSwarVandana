@model ViewModel.ClassTimingPatternsViewModel
@using Code;
@{
    ViewBag.Title = "Class Timming";
    Layout = "~/Views/Shared/_Layout.cshtml";
    //Layout = null;
}

<div class="container">
    <!-- table-info -->
    <div class="table-info">
        <div style="clear:both;margin-top:1%"></div>
        <div style="float:left;width:60%;padding-left:15%">
            @using (Html.BeginForm("CreateClassTimming", "Class"))
            {
                @Html.Hidden("ClassId", Model.classDetais.ClassId)

                <table cellpadding="0" cellspacing="0" class="table">
                    <tr bgcolor="#ccc">
                        <td class="td">Class</td>
                        <td class="td">Disciplane</td>
                        <td class="td">Student Limit</td>
                    </tr>
                    <tr>
                        <td class="td">@Model.classDetais.ClassName</td>
                        <td class="td">@Model.classDetais.DisciplaneName</td>
                        <td class="td">@Model.classDetais.StudentLimit</td>
                    </tr>
                </table>

                <div style="font-weight:bold;padding:1%">Timming Details</div>
                if (Model.li.Count == 0)
                {
                    <table cellpadding="0" cellspacing="0" class="table">
                        <tr bgcolor="#ccc">
                            <td class="td">Day</td>
                            <td class="td">Start Time</td>
                            <td class="td">End Time</td>
                            <td class="td">Add</td>
                        </tr>

                        @foreach (var v in typeof(WeekDays).SelectList<WeekDays>(true))
                        {
                            <tr>
                                <td class="td">@v.Text</td>
                                <td class="td"><input type="text" class="input" id="startTime" /></td>
                                <td class="td"><input type="text" id="endTime" class="input" /></td>
                                <td class="td">
                                    <input type="checkbox" value="@v.Value" onclick="AddRow(this)" />
                                </td>
                            </tr>
                        }
                    </table>
                }
                if (Model.li.Count == 0)
                {
                    <input type="submit" value="Save" class="submit-btn" />
                }
                <div id="Tcollection" style="margin-top:10px">
                    @Html.Action("TimeCollection", "Class", new { flag = 3, PatternId = 0, classId = @Model.classDetais.ClassId })
                </div>

            }
        </div>
    </div>
</div>

<style>
    .input {
        background: none repeat scroll 0 0 #fff;
        border: 1px solid #da7403;
        color: #585858;
        font-size: 14px;
        height: 27px;
        line-height: 27px;
        padding: 0 10px;
        width: 200px;
    }

    .submit-btn {
        margin-top: 10px;
        background: none repeat scroll 0 0 #ff9903;
        border: medium none;
        border-radius: 4px;
        color: #fff;
        cursor: pointer;
        font-size: 18px;
        height: 39px;
        line-height: 39px;
        margin-left: 23px;
        position: relative;
        width: 115px;
    }
</style>
<script src="~/Content/JS/jquery-1.11.1.js"></script>

<script type="text/javascript">
    function AddRow(o) {
        var weekdayId = $(o).val();
        var starttime = $(o).closest("tr").find("#startTime").val();
        var endtime = $(o).closest("tr").find("#endTime").val();

        var flag = 4;

        if ($(o).prop("checked") == true)
            flag = 1;
        else {
            flag = 2;
            $(o).closest("tr").find("#startTime").val('');
            $(o).closest("tr").find("#endTime").val('');
        }

        if (starttime == '' || endtime == '' || weekdayId == '') {
            $(o).prop("checked", false);
            return false;
        }
        //var isValidDate = DateCompare(endtime, starttime);
        //if (isValidDate != 1) {
        //    alert('Invalid Time');
        //    $(o).prop("checked", false);
        //    return false;
        //}

        $.get('@Url.Action("TimeCollection","Class")?flag=' + flag + "&classId=" + '@Model.classDetais.ClassId' + "&randNo=" + Math.random() + "&WeekDayId=" + weekdayId + "&starttime=" + starttime + "&endtime=" + endtime, function (data) {
            $("#Tcollection").html(data);
        })
    }

    function GetTimePattren() {
        var starttime = "";
        var endtime = "";
        var weekDayId = $("#WeekDayId").val();

        if (weekDayId == '') {
            return false;
        }
        $.get('@Url.Action("TimeCollection","Class")?flag=' + 3 + "&PatternId=" + 0 + "&classId=" + '@Model.classDetais.ClassId' + "&startTime=" + starttime + "&endTime=" + endtime + "&randNo=" + Math.random() + "&WeekDayId=" + weekDayId, function (data) {
            $("#Tcollection").html(data);
        })

    }

    function Remove(o) {
        $.get('@Url.Action("TimeCollection","Class")?flag=' + 2 + "&PatternId=" + o, function (data) {
            $("#Tcollection").html(data);
        })
    }

    function DateCompare(time1, time2) {
        var t1 = new Date();
        var parts = time1.split(":");
        if (parts.length <= 1)
            t1.setHours(parts[0], 0, 0, 0);
        else
            t1.setHours(parts[0], parts[1], 0, 0);
        var t2 = new Date();
        parts = time2.split(":");
        if (parts.length <= 1)
            t2.setHours(parts[0], 0, 0, 0);
        else
            t2.setHours(parts[0], parts[1], 0, 0);

        // returns 1 if greater, -1 if less and 0 if the same
        if (t1.getTime() > t2.getTime()) return 1;
        if (t1.getTime() < t2.getTime()) return -1;
        return 0;
    }
</script>
