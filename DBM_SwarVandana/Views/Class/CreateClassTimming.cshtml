@model ViewModel.ClassTimingPatternsViewModel
@using Code;
@{
    ViewBag.Title = "Class Timming";
    Layout = "~/Views/Shared/_Layout.cshtml";
    //Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
</head>
<body>
    @using (Html.BeginForm())
    {
        @Html.Hidden("ClassId",Model.classDetais.ClassId)
        <div>
            <table>
                <tr>
                    <td>Id</td>
                    <td>@Model.classDetais.ClassId</td>
                </tr>
                <tr>
                    <td>Did</td>
                    <td>@Model.classDetais.DisciplineId</td>
                </tr>
                <tr>
                    <td>
                        Day
                    </td>
                    <td>
                        @Html.DropDownListFor(m => Model.WeekDayId, typeof(WeekDays).SelectList<WeekDays>(true), "-- Select --", new { @class = "form-control", @onchange = "GetTimePattren()" })
                    </td>
                </tr>
            </table>
            <div>
                <input type="text" id="txtstartTime" />
                <input type="text" id="txtendTime" />
                <input type="button" value="Add" onclick="AddRow()" />
            </div>
            <div id="Tcollection">
                @Html.Action("TimeCollection", "Class", new { flag = 3, PatternId = 0, classId = Model.ClassId })
            </div>
        </div>
        <input type="submit" value="Save" />
    }
</body>
</html>
<script src="~/Content/JS/jquery-1.11.1.js"></script>
@*<script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>*@

<script type="text/javascript">
    function AddRow() {
        var starttime = $("#txtstartTime").val();
        var endtime = $("#txtendTime").val();
        var weekDayId = $("#WeekDayId").val();
        if (starttime == '' || endtime == '' || weekDayId == '') {
            return false;
        }
        var isValidDate = DateCompare(endtime, starttime);
        if (isValidDate != 1) {
            alert('Invalid Time');
            return false;
        }

        $.get('@Url.Action("TimeCollection","Class")?flag=' + 1 + "&PatternId=" + 0 + "&classId=" + '@Model.classDetais.ClassId' + "&startTime=" + starttime + "&endTime=" + endtime + "&randNo=" + Math.random() + "&WeekDayId=" + weekDayId, function (data) {
            $("#Tcollection").html(data);
        })
    }

    function GetTimePattren() {
        var starttime = "";
        var endtime = "";
        var weekDayId = $("#WeekDayId").val();

        if (weekDayId == '') {
            return false;
        }
        $.get('@Url.Action("TimeCollection","Class")?flag=' + 3 + "&PatternId=" + 0 + "&classId=" + '@Model.classDetais.ClassId' + "&startTime=" + starttime + "&endTime=" + endtime + "&randNo=" + Math.random() + "&WeekDayId=" + weekDayId, function (data) {
            $("#Tcollection").html(data);
        })

    }

    function Remove(o) {
        $.get('@Url.Action("TimeCollection","Class")?flag=' + 2 + "&PatternId=" + o, function (data) {
            $("#Tcollection").html(data);
        })
    }

    function DateCompare(time1, time2) {
        var t1 = new Date();
        var parts = time1.split(":");
        if (parts.length <= 1)
            t1.setHours(parts[0], 0, 0, 0);
        else
            t1.setHours(parts[0], parts[1], 0, 0);
        var t2 = new Date();
        parts = time2.split(":");
        if (parts.length <= 1)
            t2.setHours(parts[0], 0, 0, 0);
        else
            t2.setHours(parts[0], parts[1], 0, 0);

        // returns 1 if greater, -1 if less and 0 if the same
        if (t1.getTime() > t2.getTime()) return 1;
        if (t1.getTime() < t2.getTime()) return -1;
        return 0;
    }
</script>
